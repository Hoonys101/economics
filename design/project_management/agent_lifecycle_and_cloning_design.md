### **제목: 에이전트 생명주기 및 복제 메커니즘 설계**

**1. 목표:**
파산한 에이전트(가계, 기업)를 성공한 에이전트로 대체하는 '도태 및 복제' 로직을 모듈화합니다. 이를 통해 코드 중복을 방지하고, 향후 다른 유형의 에이전트가 추가될 경우에도 쉽게 확장할 수 있는 구조를 만듭니다.

**2. 설계 방안:**

*   **1단계: `clone()` 메서드 구현**
    *   `Firm`과 `Household` 클래스에 각각 `clone()` 메서드를 구현합니다.
    *   이 메서드는 에이전트의 모든 속성, 특히 학습된 **AI 모델(Q-테이블)까지 깊은 복사(deep copy)**하여 완전히 독립적인 새 에이전트 인스턴스를 반환해야 합니다.

*   **2단계: 복제 로직 모듈화 (공통 헬퍼 함수)**
    *   `simulation/engine.py`의 `Simulation` 클래스 내에, `_handle_agent_replacement`와 같은 범용 헬퍼 함수를 생성합니다.
    *   이 함수는 특정 유형의 에이전트 리스트(가계 또는 기업)를 받아, 비활성화된 에이전트 수만큼 가장 성공적인 에이전트(자산 기준)를 찾아 복제한 후, 새로 생성된 에이전트 리스트를 반환합니다.

*   **3단계: 시뮬레이션 엔진 통합**
    *   기존 `_handle_agent_lifecycle` 메서드의 구조를 리팩토링합니다.
    *   에이전트 비활성화 처리 후, 새로 만든 `_handle_agent_replacement` 헬퍼 함수를 가계와 기업 리스트에 각각 호출하여 에이전트 수를 보충하는 로직을 추가합니다.

---

**3. '성공적인 주체' 선택 기준 및 신규 진입자 고려사항 (개념 재정의)**

*   **공통 개념:** 도태된 에이전트가 발생했을 때, 남은 활성 에이전트 중 가장 '성공적인' 에이전트가 복제되어 시뮬레이션에 재진입합니다.
*   **선택 기준 (현재 논의 중):**
    *   **가계 (Household):**
        *   최소 자산 기준을 넘기고, 욕구 충족도가 높아 안정적인 상태를 유지하는 가계 (예: 자산 상위 X%, 욕구치 하위 Y% 등)
    *   **기업 (Firm):**
        *   높은 이윤과 충분한 자산을 가진 기업 (예: 이윤 상위 X%, 자산 상위 Y% 등)
*   **신규 진입자 (복제된 에이전트) 초기 상태 고려사항:**
    *   **자산 처리 (화폐 보존 원칙 - '출아법' 개념 적용):**
        *   복제된 에이전트의 초기 자산은 **`config.INITIAL_CLONE_ASSETS`** 만큼으로 설정됩니다.
        *   이 자산은 **복제 대상이 된 '부모' 에이전트의 자산에서 정확히 `config.INITIAL_CLONE_ASSETS` 만큼 차감**됩니다.
        *   **복제 전후, 부모 에이전트와 복제된 에이전트의 자산 총합은 시뮬레이션 내 화폐 총량 보존 원칙에 따라 일정하게 유지됩니다.**
        *   **'출아법' 조건:** 부모 에이전트는 복제 후에도 최소한 `config.INITIAL_CLONE_ASSETS * 2` 이상의 자산을 보유해야만 복제 대상이 될 수 있습니다. (즉, 2:1 비율로 자산을 유지하며 분리)
        *   이 로직은 `simulation/engine.py`의 `_handle_agent_replacement` 헬퍼 함수 내에서 복제된 에이전트가 생성된 직후에 이루어집니다. 이를 통해 시뮬레이션 내 화폐 총량이 일정하게 유지됩니다.
    *   **인벤토리 처리 (재화 보존 원칙):**
        *   복제된 에이전트(가계 및 기업)는 **빈 인벤토리(empty inventory) 상태로 시작**합니다.
        *   새로운 에이전트는 시뮬레이션 내에서 스스로 재화를 생산하거나 구매하여 인벤토리를 채워야 합니다.
    *   **가계:** 복제 시 현재 자산과 욕구 상태를 물려받되, 고용 상태 등은 초기화될 수 있습니다.
    *   **기업:**
        *   복제 시 현재 자산, 생산 목표, 생산성 등은 물려받습니다.
        *   **주식(Stock) 문제:** 복제된 기업은 **주식을 발행하지 않은 상태로 시작**합니다. 주식 발행은 기업의 의사결정 로직에 따라 추후 이루어지도록 합니다. 이는 복제 시 주식 소유권 문제를 단순화하고, 새로운 기업이 시장에서 스스로 자본을 조달하도록 유도합니다.
        *   **시장 진입 효과:** 새로운 기업의 진입이 시장에 미치는 영향(경쟁 심화 등)도 고려해야 합니다.

---