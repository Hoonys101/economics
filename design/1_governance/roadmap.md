# Prioritized Improvement Roadmap (Delegated to Jules)

## ğŸŸ¢ Low Risk: Stability & Visualization
- [x] 1. Type Stability (Fix 13+ Mypy Errors)
- [ ] 2. Edge Case Testing (Disaster Scenario Suite)
- [ ] 3. Market Network Visualization (UI Dependency)

## ğŸŸ¡ Medium Risk: Agent Logic & Tuning
- [ ] 4. Mitosis Mechanism Verification & Tuning
- [ ] 5. Social Inheritance (Child-Parent state transfer)
- [ ] 6. Advanced Needs Hierarchy (Maslow's model)

## ğŸ”µ Completed / Integrated (Recent Phases)
- [x] 7. Brand Value & Product Quality Differentiation (Phase 6)
- [x] 8. Adaptive Price Expectations (Phase 8)
- [x] 9. Corporate M&A (Phase 9)
- [x] 10. Monetary Policy (Phase 10)
- [x] 11. Portfolio Optimization (Phase 16 -> Phase 25)
- [x] 12. Corporate Intelligence (Phase 16-B)
- [x] 13. Stock Exchange High-Fidelity Activation (Phase 25)

## ğŸ”´ Pending / Future
- [x] 14. Phase 17+: Market Diversity (Real Estate, Services, Raw Materials)
 - [x] 17-1: Service Market (Completed)
 - [x] 17-2: Raw Materials (Completed)
 - [x] 17-3a: Real Estate Rental (Completed)
 - [x] 17-3b: Real Estate Sales & Mortgage (Completed)
 - [x] 17-4: The Society of Vanity & Control (Completed)
 - [x] 17-5: The Leviathan (Completed)
- [x] 15. **Phase 19: Population Dynamics** (Birth Strike, Extinction Scenario)
 - [x] Task 1: Demographic Manager (Birth/Aging/Death System)
 - [x] Task 2: Evolutionary Decision Engine (r/K Strategy, Time Allocation)
 - [x] Task 3: Household Extensions (Education, Time Budget, Children)
 - [x] Task 4: Verification (The Rat Race Experiment Success)
- [x] 16. **Phase 20: The Matrix & Advanced Dynamics** (Completed)
 - [x] **Step 1: Cognitive Architecture (The Matrix Core)**
 - [x] Task 1.1: System 1 (Fast/RL) & System 2 (Slow/Planner) Integrated
 - [x] Task 1.2: Internal World Model (NPV Projection)
 - [x] **Step 2: Socio-Tech Dynamics**
 - [x] Task 2.1: Lactation & Appliance Dependency
 - [x] Task 2.2: Gender-Specific Education & Market Access
 - [x] **Step 3: Real Estate & Integration**
 - [x] Task 3.1: Supply Dynamics & Immigration Model
 - [x] Task 3.2: Scenario Verification (Housing Costs Impact)

- [x] **Step 3: Real Estate & Integration**
 - [x] Task 3.1: Supply Dynamics & Immigration Model
 - [x] Task 3.2: Scenario Verification (Housing Costs Impact)

## ğŸ”­ Phase 20.5: The Simulation Cockpit (Stabilization)
- **Goal**: Visibility & God-Mode Control (UI).
- **Tech**: Streamlit.
- [ ] Dashboard Scaffolding (Setup & Engine Bridge).
- [ ] God Mode Controls (Sliders for Macro/Social/Tech).
- [ ] Deep Dive Analytics (System 2 Logs & Heatmaps).

## ğŸ”® Phase 21+: The Future Visions (Long-Term)

### Vision A: The Political Animal (Politics & Democracy)
- **Goal**: Introduce Voting Power and Democracy to balance Agent Intelligence (Labor vs Capital).
- **Status**: ğŸŸ¢ **SPECCED (Ready for Implementation)**
- **Reference Spec**: [`design/3_work_artifacts/specs/phase17-5_leviathan_spec.md`](../3_work_artifacts/specs/phase17-5_leviathan_spec.md)
- **Scenario**: 
 - Renters vote for Rent Control & Subsidies.
 - Owners vote for Tax Cuts & Asset Protection.
 - **Two-Party System**: BLUE (Growth) vs RED (Equality) competitive policy loop.
 - Simulation of Gerontocracy (Rule of the Old) vs Youth Disenchantment.

### Phase 23: The Great Expansion (Industrial Revolution) ğŸ”„ **[RESUMED]**
- **Goal**: Escape the Malthusian Trap via Technology & Education.
- **Tasks**:
 - [x] Productivity Revolution (Chemical Fertilizer)
 - [x] Public Education System (Social Mobility)
 - [x] The Baby Boom (Golden Age Stabilization)

### Phase 24: Adaptive Evolution (The Invisible Hand) âœ…
- **Goal**: Transition from manual guardrails to automated market equilibrium.
- **Tasks**:
 - [x] The Invisible Hand (Market Auto-Balancer)
 - [x] Adaptive Policy Evolution (RL Government)
 - [x] Economic CPR (Bootstrap Logic)

### Phase 25: The Financial Superstructure (Stock Market) âœ…
- **Goal**: Realistic capital markets and wealth-biased investment.
- **Tasks**:
 - [x] Stock Exchange High-Fidelity Activation
 - [x] Portfolio Manager with Wealth Bias

### Phase 26: Financial Strategy Integration â­ **[CURRENT]**
- **Goal**: Link macro environment to retail/institutional strategy.
- **Pre-requisite**:
 - [x] **TD-024**: Test Path Correction (Pytest ê²½ë¡œ ì˜¤ë¥˜ í•´ê²°) **[RESOLVED]**
- **Tasks**:
 - [x] Macro-Linked Portfolio (Dynamic Risk Aversion)
 - [ ] Signal Intelligence Engine (Judge & Sentinel)
 - [ ] Inverse ETF & Hedging Mechanism
 - [ ] Strategy Backtest Framework

### Phase 26.5: Sovereign Debt & Corporate Credit â­ **[COMPLETED]**
- **Goal**: Transition to debt-based financing and market-driven interest rates.
- **Tasks**:
 - [x] Finance System Scaffolding (api.py & DTOs) âœ… **[MERGED 2026-01-16]**
 - [x] Finance System Double-Entry Refactor (Zero-Question Spec) âœ… **[MERGED 2026-01-24]**
 - [x] Altman Z-Score & Corporate Debt Refactor (with Startup Grace Period) âœ…
 - [x] National Debt Auction & Yield Curve Mechanism âœ…

### Phase 27: Credit Creation Recovery â­ **[COMPLETED]**
- **Goal**: Implement "Fractional Reserve Banking" on top of the SettlementSystem. Reactivate credit growth while maintaining zero-sum integrity.
- **Key Objectives**:
 - **TD-105**: Resolve the +320 Drift Mystery (Unknown Minting). âœ…
 - **TD-106**: Link Bankruptcy Liquidation to `Total Money Destroyed` ledger. âœ…
 - **M2 Multiplier**: Enable Banks to create credit (loans) as an asset expansion, not magic money. âœ…
- **Tasks**:
 - [x] Forensic Detective (TD-105 Solution)
 - [x] Bankruptcy Ledger Linking (TD-106 Solution)
 - [x] Fractional Reserve Logic & LTV/DTI Reliability (2026-01-27)

### Phase 31: The Ordered Universe âœ…
- **Goal**: Establish structural time integrity and legal priority in liquidation.
- **Tasks**:
    - [x] **Post-Phase Hook**: Automated M2 audit at tick-end.
    - [x] **Liquidation Waterfall (TD-187)**: Prioritized asset distribution (Taxes > Wages > Creditors).
    - [x] **Atomic Inheritance (TD-160)**: SettlementSystem-based legacy escrow.

### Phase 32: The Great Housewarming (Mortgage Restoration) ğŸ—ï¸
- **Goal**: Restore the housing credit pipeline with macro-prudential safeguards.
- **Tasks**:
    - [ ] **Mortgage Pipeline Modernization**: Implement `MortgageApplicationDTO` flow.
    - [ ] **Macro-Prudential Regulation**: Automated LTV/DTI checks in `LoanMarket`.
    - [ ] **Seamless Payment Integration**: Atomic home purchase saga.
    - [ ] **Bubble Observatory**: M2 surge and Housing Price Index monitoring.

### Phase 28: Structural Stabilization & Verification â­ **[CURRENT]**
- **Goal**: Clean up technical debt from rapid architectural changes and verify the new economic engine.
- **Tasks**:
 - [x] **Operation Sacred Refactoring**: Purge Reflux System & Decompose TickScheduler. âœ… (2026-01-28)
 - [x] **Operation Abstraction Wall**: DTO-only Agents & Purity Gate. âœ… (2026-01-28)
 - [ ] **Operation Clean Sweep (Tactical Sanitation)**
 - Replace hardcoded scenarios with generalized strategy flags.
 - Harden Purity Gate (externalize rules).
 - Documentation Consolidation (Fix file location chaos).
 - [ ] **Test Suite Cleanroom (TD-122)**
 - Reorganize `tests/` into `unit` (fast, mock) vs `integration` (slow, real DB).
 - Remove legacy/duplicate tests.
 - [ ] **Monetary Dynamics Verification**
 - Verify Inflation/Deflation spirals under Fractional Reserve Banking.
 - Tune `RESERVE_REQUIREMENT` to prevent infinite money glitches.
 - [ ] **Financial Parameter Externalization**
 - Move hardcoded assumptions in `HousingSystem` (e.g., `8.0` work hours, `0.01` payment rate) to `economy_params.yaml`.

### Phase 22: The Awakening (Adaptive AI) **[COMPLETED]**
- **Goal**: Wake up the Agents (System 2 Activation).
- **Tasks**:
 - [x] Liquidity Crisis Resolution (Capital Injection & Bidding)
 - [x] Adaptive Breeding (System 2 NPV Mode)
 - [x] Engine Vectorization (NPV Matrix Optimization)
 - [x] Adaptive Housing (Buy vs Rent Logic) **[COMPLETED]**
 - [x] Inheritance (Zero Leak) **[COMPLETED]**
 - [x] Real Estate Liquidity **[COMPLETED]**
 - [ ] The Dynasty Report (Social Mobility Analysis) **[DEFERRED to P23]**

### Vision B: Corporate Empires (Corporate AI Adoption)
- **Goal**: Upgrade Firms to Active AI Agents.
- **Scenario**:
 - Firms invest in Automation to combat Labor Scarcity (Phase 20 result).
 - Resulting Unemployment vs Productivity Gains.
 - Rise of Monopolies and "Too Big To Fail".
- **Status**: ğŸ—ï¸ Planning

### Vision C: The Central Bank (Macro Control Tower)
- **Goal**: User-in-the-loop Macroeconomic Control.
- **Scenario**:
 - User (President/Governor) sets Interest Rates & Tax Policy.
 - AI-based Policy Optimization (RL Government).
 - Crisis Management Mode (Great Depression/Hyperinflation).
- [ ] 17. Commercial Bank Deepening (Lender of Last Resort)
- [ ] 18. Time Machine (Backtester)

## ğŸ§  **[CORE PHILOSOPHY] Rule-Based â†’ Adaptive AI Migration**
> **Goal**: ëª¨ë“  í•˜ë“œì½”ë”©ëœ ê·œì¹™ ê¸°ë°˜ ë¡œì§ì„ í•™ìŠµ ê¸°ë°˜ ë˜ëŠ” ì ì‘í˜• ì‹œìŠ¤í…œìœ¼ë¡œ ì „í™˜
> **Rationale**: ë³¸ í”„ë¡œì íŠ¸ì˜ í•µì‹¬ ì² í•™ - ì—ì´ì „íŠ¸ëŠ” "í”„ë¡œê·¸ë˜ë°ëœ ëŒ€ë¡œ" í–‰ë™í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ "ê²½í—˜ì—ì„œ í•™ìŠµ"í•´ì•¼ í•¨

### âš ï¸ Architect Prime Diagnosis: The Asymmetry of Intelligence
> **í˜„ì¬ ê²½ì œ ë¶•ê´´ ì›ì¸:** ì§€ëŠ¥ì˜ ë¹„ëŒ€ì¹­ (Asymmetry)

| Agent | Intelligence Level | ê²°ê³¼ |
|---|---|---|
| **Corporate (Capital)** | System 2 (AI/Optimization) âœ… | ë…¸ë™ ë¹„ìš© 0ìœ¼ë¡œ ìµœì í™” |
| **Government/Labor** | Rule-Based (Fixed) âŒ | AI ê¸°ì—… í†µì œ ë¶ˆê°€ |

â†’ **"ë˜‘ë˜‘í•œ ì•…ë‹¹(ê¸°ì—…)"ê³¼ "ë©ì²­í•œ ê²½ì°°(ì •ë¶€)"ì˜ ì‹¸ì›€** = ë””ìŠ¤í† í”¼ì•„ í•„ì—°

### í˜„ì¬ Rule-Based ë¶€ì±„ (Technical Debt)
| Component | í˜„ì¬ ìƒíƒœ | ëª©í‘œ ìƒíƒœ |
|---|---|---|
| `ActionProposalEngine` | ì¡°ê±´ë¬¸ ê¸°ë°˜ í–‰ë™ ì œì•ˆ | RL Policy Network |
| `CorporateManager` | íœ´ë¦¬ìŠ¤í‹± ê³ ìš©/í•´ê³  | Firm System 2 NPV ìµœì í™” |
| `HousingManager` | NPV ì„ê³„ê°’ í•˜ë“œì½”ë”© | í•™ìŠµëœ ì„ í˜¸ë„ |
| `PortfolioManager` | Value/Momentum ê·œì¹™ | Multi-Factor Learning |
| `DemographicManager` | ì¡°ê±´ë¶€ ì¶œì‚° ë¡œì§ | ì ì‘í˜• r/K ì „ëµ |
| `Government.calculate_*` | ê³ ì • ì„¸ìœ¨ ê³µì‹ | ì •ì±… ìµœì í™” RL |

### Migration Strategy (3-Phase)
```
Phase A (Current): Rule-Based ê°€ë“œë ˆì¼ë¡œ AI í­ì£¼ í†µì œ
 â””â”€ LABOR_ELASTICITY_MIN, AUTOMATION_TAX ë“± í•˜ë“œ ì œì•½
Phase B (Next): í•™ìŠµëœ ì •ì±…ì´ ê·œì¹™ì„ ì ì§„ì  ëŒ€ì²´
 â””â”€ RL Governmentê°€ ì„¸ìœ¨/ê·œì œë¥¼ ë™ì  ì¡°ì •
Phase C (Target): ê·œì¹™ ì™„ì „ ì œê±° (Pure AI Ecosystem)
 â””â”€ ëª¨ë“  ì—ì´ì „íŠ¸ê°€ í•™ìŠµ ê¸°ë°˜
```

### Phase A ê°€ë“œë ˆì¼ (/044)
| Guardrail | ê¸°ëŠ¥ | íŒŒë¼ë¯¸í„° |
|---|---|---|
| **ë…¸ë™ ë¶„ë°°ìœ¨ í•˜í•œ** | AIê°€ Î± < X% ë§Œë“¤ì§€ ëª»í•¨ | `LABOR_ELASTICITY_MIN = 0.3` |
| **ìë™í™”ì„¸** | ìë™í™” ë¹„ìš© ê¸°í•˜ê¸‰ìˆ˜ ì¦ê°€ | `AUTOMATION_TAX_RATE` |
| **í•´ê³  ë¹„ìš©** | ëŒ€ëŸ‰ í•´ê³  ì‹œ í‡´ì§ê¸ˆ ê°•ì œ | `SEVERANCE_PAY_WEEKS` |
| **ìµœì € ì„ê¸ˆ ì—°ë™** | ìƒì‚°ì„± ìƒìŠ¹ ì‹œ ì„ê¸ˆë„ ìƒìŠ¹ | `MIN_WAGE_PRODUCTIVITY_LINK` |



- [ ] 21. **Config Refactoring Pass 2**: ëŸ°íƒ€ì„ ì¡°ì • ì‹œìŠ¤í…œ (CLI/API ì—°ë™)

## âš ï¸ [MAJOR OVERHAUL REQUIRED] Cognitive Architecture (Phase 20+)
> **Goal**: System 1 (Fast/RL) + System 2 (Slow/Planner) ë¶„ë¦¬
> **Trigger**: ë¶€ë™ì‚°/ì—°ê¸ˆ ë“± ì´ˆì¥ê¸° ê²°ì •ì´ í•„ìš”í•œ ê¸°ëŠ¥ í™•ì¥ ì‹œ
> **Reference**: Kahneman's Dual-Process Theory

- **Current State**: RL(Q-Learning)ì€ ë‹¨ê¸° ë³´ìƒì—ë§Œ ë°˜ì‘ (ê·¼ì‹œì•ˆì ).
- **Future State**: Model-Based Planningì„ í†µí•´ ë¯¸ë˜ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì‹œë®¬ë ˆì´ì…˜í•˜ê³  í˜„ì¬ í–‰ë™ì„ ì œì•½.
- **Interim Solution**: Phase 17-3ì—ì„œëŠ” `HousingManager`ê°€ NPV ê³„ì‚°ìœ¼ë¡œ ëŒ€ë¦¬ ìˆ˜í–‰.

## ğŸŸ£ Architecture v3.0: High-Performance Simulation (Long-Term)
> **Goal**: Optimization Strategy for 100k+ Agents (OOP -> DOP Transition)
> **Advisor**: Architect Prime

### 1. Philosophy: OOP to DOP (Data-Oriented Programming)
- **Problem**: `for agent in agents: agent.step()` is the bottleneck due to Python overhead and cache misses.
- **Solution**: Maximizing SIMD (Single Instruction, Multiple Data) and vectorized operations.

### 2. Implementation Stages
#### Stage 1: JIT Compilation (Low Effort, High Gain)
- **Action**: Apply `@numba.jit` to math-heavy functions (utility calc, tax calc).
- **Benefit**: 10x~50x speedup for computational hotspots without structural changes.

#### Stage 2: Profiling & Vectorized Decisions (The "Think" Layer)
- **Action**: Profile via `cProfile` to find bottlenecks.
- **Action**: Convert agent decision logic (Labor, Consumption) to **Vectorized Operations** using NumPy/Pandas.
 ```python
 # Example: Vectorized Labor Decision
 labor_supply = np.where(assets > threshold, 0, 8)
 ```
- **Benefit**: 100x speedup for decision phase (Parallelizable).

#### Stage 3: Batch Transaction Matching (The "Act" Layer)
- **Problem**: Sequential transactions handling resource contention.
- **Solution**: **Batch Matching** via Matrix Operations.
 - Construct `Demand Matrix` and `Supply Matrix`.
 - Use Linear Algebra (MatMul) to calculate utility scores.
 - Resolve contention via Pro-rata or Random Vectorized choices.

#### Stage 4: Entity Component System (ECS) (Final Form)
- **Action**: Replace Agent Classes with a monolithic **DataFrame/Database** (State Table).
- **Reference**: Standard pattern in Game Development (Data-Driven Design).
