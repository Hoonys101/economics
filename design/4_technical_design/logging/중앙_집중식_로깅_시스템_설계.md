# 중앙 집중식 로깅 시스템 설계

## 1. 목표 (Goals)

기존의 분산된 `print`문과 비효율적인 로그를 대체하고, 디버깅 효율을 극대화하기 위해 중앙에서 제어 가능한 지능형 로깅 시스템을 구축한다.

- **중앙 제어 (Centralized Control):** 단일 설정 파일을 통해 프로젝트 전체의 로깅 동작을 제어한다.
- **선택적 로깅 (Selective Logging):** 로그 레벨, 모듈, 시뮬레이션 틱, 에이전트 ID, 커스텀 태그 등 다양한 조건으로 로그를 정밀하게 필터링한다.
- **동적 설정 (Dynamic Configuration):** 코드 수정이나 재시작 없이 설정 파일 변경만으로 로깅 동작을 변경할 수 있게 한다.

---

## 2. 핵심 구성 요소 (Core Components)

### 2.1. 설정 파일: `log_config.json`

프로젝트 루트에 위치하며, 모든 로깅 규칙을 정의하는 JSON 파일.

```json
{
  "enabled": true,
  "level": "DEBUG",
  "output": "file",
  "log_file": "logs/debug_custom.log",
  "filters": {
    "tick_range": [0, 20],
    "modules": [
      "simulation.decisions.firm_decision_engine",
      "simulation.engine"
    ],
    "agent_ids": [
      "firm_0"
    ],
    "tags": [
      "production",
      "hiring"
    ]
  }
}
```
- `enabled`: `true`일 때만 로깅 시스템이 활성화된다.
- `level`: 전역 최소 로그 레벨 (`DEBUG`, `INFO`, `WARNING`, `ERROR`).
- `output`: 로그 출력 위치. `'file'` 또는 `'console'`.
- `log_file`: `output`이 `'file'`일 경우, 로그를 저장할 경로.
- `filters`: 로그를 필터링할 조건. 각 필드는 AND 조건으로 조합된다. 필드 내의 리스트는 OR 조건이다.
    - `tick_range`: `[start, end]` 형식의 리스트. 이 틱 범위 내의 로그만 허용.
    - `modules`: 로그를 허용할 모듈 경로의 리스트.
    - `agent_ids`: 로그를 허용할 에이전트 ID의 리스트.
    - `tags`: 로그에 포함된 태그 중 허용할 태그의 리스트.

### 2.2. 로깅 관리자: `utils/logging_manager.py`

`log_config.json`을 읽어 파이썬의 표준 `logging` 모듈을 설정하는 역할을 담당한다.

- **`setup_logging()` 함수:** `main.py` 등 진입점에서 단 한 번 호출된다. `log_config.json`을 파싱하여 포맷, 핸들러, 필터를 설정한다.
- **`ContextualFilter` 클래스:** `logging.Filter`를 상속받아 `tick_range`, `modules`, `agent_ids`, `tags`에 대한 커스텀 필터링 로직을 수행한다.

### 2.3. 로거 사용법 (Usage)

각 모듈에서는 표준 `logging` 라이브러리를 사용하며, `extra` 파라미터를 통해 컨텍스트 정보를 전달한다.

```python
# AS-IS:
# print(f"Tick {tick}: Firm {firm.id} is producing {amount}.")

# TO-BE:
import logging
logger = logging.getLogger(__name__) # 모듈 경로 기반 로거 자동 생성

# ... in a method ...
log_context = {
    'tick': current_tick,
    'agent_id': firm.id,
    'tags': ['production', 'decision']
}
logger.info(
    f"생산량 결정: {production_amount}", 
    extra=log_context
)
```

---

## 3. 기대 효과

- **디버깅 효율 극대화:** 원하는 정보만 정확히 볼 수 있어 문제 원인 파악 시간을 단축한다.
- **코드 가독성 향상:** `print`문이 사라지고, 의도가 명확한 구조화된 로그 호출만 남는다.
- **유연성 및 확장성:** 코드 수정 없이 `log_config.json` 파일만으로 다양한 디버깅 시나리오에 대응할 수 있다.
