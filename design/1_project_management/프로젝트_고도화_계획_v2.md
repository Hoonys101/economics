# 경제 시뮬레이션 고도화 계획 (v2)

## 1. 개요

이 문서는 최근 도입된 데이터베이스 및 MVVM 아키텍처의 안정적인 기반 위에서, 시뮬레이션의 현실성을 한 단계 끌어올리고 장기적인 확장성을 확보하기 위한 구체적인 실행 계획을 정의합니다.

각 과업은 **단기(현실성 강화), 중기(세계 모델 확장), 장기(분석 기능 고도화)**의 단계별로 구분되며, 명확한 목표와 검증 방법을 통해 체계적으로 프로젝트를 진행하는 것을 목표로 합니다.

---

## 2. Phase 1: 시뮬레이션 현실성 강화 (단기 과제)

현재 아키텍처 위에서 비교적 빠르게 구현하여 시뮬레이션의 깊이를 더하는 과제들입니다.

### **과업 1.1: 기초 정부(Government) 에이전트 도입**

-   **목표**: 세금 징수와 보편적 기본소득(UBI) 지급이라는 정부의 가장 기본적인 재분배 기능을 구현하여, 부의 순환에 정부가 미치는 영향을 관찰합니다.
-   **주요 구현 내용**:
    1.  **`Government` 클래스 생성**: `simulation/agents/government.py`에 새로운 에이전트 클래스를 정의합니다.
    2.  **세금 징수 로직**: `simulation/engine.py`의 `run_tick` 마지막 단계에서, 모든 가계의 소득과 기업의 이윤을 기준으로 일정 비율(config.py에 세율 정의)의 세금을 징수하여 `Government` 에이전트의 자산으로 이전합니다.
    3.  **기본소득 지급 로직**: `Government` 에이전트는 징수한 세금의 일부 또는 전부를 다음 틱에서 모든 가계에 균등하게 분배합니다.
-   **기대 효과**:
    -   자연 발생적 불평등을 완화하고, 저소득 가계의 파산을 줄여 시뮬레이션의 안정성을 높입니다.
    -   세금과 기본소득이 소비, 생산, 고용에 미치는 영향을 분석할 수 있는 기반을 마련합니다.
-   **검증 방법**:
    -   시뮬레이션 실행 후, `simulation_data.db`의 `agent_states` 테이블에서 정부 에이전트의 자산이 틱마다 변화하는지 확인합니다.
    -   가계의 자산 변화 로그를 추적하여 세금 납부와 기본소득 수령이 정상적으로 반영되는지 검증합니다.

### **과업 1.2: 중앙은행(Central Bank) 개념 도입**

-   **목표**: 통화 정책의 핵심 변수인 '기준 금리'를 시뮬레이션에 도입하여, 금리 변화가 경제에 미치는 영향을 분석할 수 있는 기초를 마련합니다.
-   **주요 구현 내용**:
    1.  **`CentralBank` 클래스 생성**: `simulation/agents/central_bank.py`에 기준 금리(`base_interest_rate`)를 관리하는 단순한 클래스를 정의합니다.
    2.  **금리 연동**: `simulation/agents/bank.py`의 `Bank` 에이전트가 대출 상품의 금리를 결정할 때, `CentralBank`의 기준 금리에 가산금리를 더하는 방식으로 변경합니다.
    3.  **API 추가 (선택 사항)**: UI에서 기준 금리를 동적으로 변경할 수 있는 API 엔드포인트를 `app.py`에 추가합니다.
-   **기대 효과**:
    -   금리 인상/인하가 기업의 투자(대출) 결정과 가계의 저축/소비 패턴에 어떤 영향을 미치는지 관찰할 수 있습니다.
-   **검증 방법**:
    -   단위 테스트를 통해 `Bank`의 대출 금리가 `CentralBank`의 기준 금리 변화에 따라 올바르게 연동되는지 확인합니다.
    -   시뮬레이션 중 기준 금리를 변경했을 때, 기업의 대출 요청 빈도나 규모에 변화가 생기는지 로그를 통해 확인합니다.

### **과업 1.3: 재고 보유 비용(Inventory Holding Cost) 구현**

-   **목표**: 기업이 과잉 생산을 회피하고 시장 수요에 맞춰 생산량을 조절하도록 현실적인 비용 압박을 추가합니다.
-   **주요 구현 내용**:
    1.  **비용 부과 로직**: `simulation/engine.py`의 `run_tick`에서 매 틱마다 모든 `Firm` 에이전트의 총 재고 가치를 계산하고, 이에 비례하는 비용(`config.py`에 비용 비율 정의)을 자산에서 차감합니다.
-   **기대 효과**:
    -   시장의 자율적인 재고 및 가격 조절 능력이 향상됩니다.
    -   기업의 이윤 계산이 더욱 현실적으로 변합니다.
-   **검증 방법**:
    -   재고가 많은 기업의 자산이 재고가 적은 기업보다 더 빠르게 감소하는지 `agent_states` 테이블을 통해 확인합니다.
    -   재고 비용 도입 후, 기업들이 생산량을 줄이거나 판매 가격을 인하하려는 경향을 보이는지 관찰합니다.

---

## 3. Phase 2: 세계 모델 확장 (중기 과제)

시뮬레이션에 새로운 시장과 상호작용을 추가하여 경제 시스템을 더욱 복잡하고 현실적으로 만듭니다.

### **과업 2.1: 주식 시장(Stock Market) 구현**

-   **목표**: 가계의 부 축적 방식을 '노동 소득'에서 '자본 소득'으로 확장하고, 기업의 자금 조달 및 성장 전략을 다각화합니다.
-   **주요 구현 내용**:
    1.  **`Share` 데이터 모델 정의**: `simulation/models.py`에 주식 정보를 담는 데이터 클래스를 추가합니다.
    2.  **`StockMarket` 클래스 생성**: `OrderBookMarket`과 유사한 방식으로 주식 거래를 중개하는 `simulation/markets/stock_market.py`를 구현합니다.
    3.  **기업 로직 수정**: `Firm` 클래스에 주식 발행(`issue_shares`) 및 배당금 지급(`distribute_dividends`) 메서드를 추가합니다.
    4.  **가계 로직 수정**: `HouseholdDecisionEngine`에 여유 자금으로 주식을 매수/매도하는 의사결정 로직을 추가합니다.
-   **기대 효과**:
    -   부의 불평등이 심화되거나 완화되는 과정을 관찰할 수 있습니다.
    -   기업의 소유 구조와 경영 성과가 가계의 부에 미치는 영향을 분석할 수 있습니다.
-   **검증 방법**:
    -   주식 거래 `Transaction`이 `simulation_data.db`에 정상적으로 기록되는지 확인합니다.
    -   배당금이 지급될 때, 주식을 보유한 가계의 자산이 증가하는지 검증합니다.

### **과업 2.2: 기술 발전(R&D) 모델 구체화**

-   **목표**: 기업의 장기 성장 동력을 시뮬레이션에 도입하고, 가계의 '학습/성장 욕구'와 자연스럽게 연결합니다.
-   **주요 구현 내용**:
    1.  **`research` 스킬 추가**: `data/goods.json` 또는 별도 설정에 '연구'와 같은 고급 스킬을 정의합니다.
    2.  **R&D 노동 시장**: `FirmDecisionEngine`이 이익의 일부를 R&D에 투자하기로 결정하면, 노동 시장에 높은 임금과 특정 스킬을 요구하는 '연구직' 채용 공고(BUY 주문)를 내도록 수정합니다.
    3.  **생산성 향상**: 연구직 채용에 성공한 기업은 `productivity_factor`가 향상되어 더 적은 노동력으로 더 많은 생산을 할 수 있게 됩니다.
-   **기대 효과**:
    -   기술 혁신이 생산성, 임금, 물가에 미치는 영향을 장기적으로 관찰할 수 있습니다.
    -   가계가 높은 임금을 받기 위해 '학습'을 통해 고급 스킬을 획득하려는 동기를 부여합니다.
-   **검증 방법**:
    -   R&D에 성공한 기업의 `productivity_factor`가 실제로 증가하는지 `agent_states` 테이블을 통해 확인합니다.
    -   시간이 지남에 따라 전체 시뮬레이션의 평균 생산성이 증가하는 추세를 관찰합니다.

---

## 4. Phase 3: 분석 기능 및 품질 관리 (장기 과제)

시뮬레이션의 분석 가치를 극대화하고, 프로젝트의 지속 가능성을 확보합니다.

### **과업 3.1: 외부 충격(External Shocks) 시뮬레이션 기능**

-   **목표**: 경제 시스템의 안정성과 회복탄력성을 테스트하고, 다양한 'What-if' 시나리오 분석을 가능하게 합니다.
-   **주요 구현 내용**:
    1.  **이벤트 스케줄러 구현**: `simulation/engine.py`에 특정 틱에 특정 이벤트를 발생시키는 스케줄러를 추가합니다.
    2.  **이벤트 API 정의**: `(event_type, tick, parameters)` 형식의 이벤트를 정의합니다. (예: `('supply_shock', 100, {'item_id': 'food', 'multiplier': 0.5})`)
    3.  **UI 연동**: UI에서 사용자가 직접 이벤트를 스케줄링할 수 있는 인터페이스를 제공합니다.
-   **기대 효과**: 경제 위기, 기술 혁신, 재난 등 다양한 시나리오를 모의실험할 수 있습니다.
-   **검증 방법**: 스케줄된 틱에 해당 이벤트가 발생하고, 시뮬레이션의 경제 지표(물가, 생산량 등)가 급격히 변화하는지 확인합니다.

### **과업 3.2: 테스트 커버리지 확대**

-   **목표**: 데이터 계층의 안정성을 확보하고, 향후 리팩토링에 대한 신뢰도를 높입니다.
-   **주요 구현 내용**:
    1.  **Repository 통합 테스트**: `simulation/db/repository.py`의 각 메서드가 실제 DB에 데이터를 정확히 쓰고 읽는지 검증하는 `pytest` 테스트 코드를 작성합니다.
    2.  **ViewModel 단위 테스트**: `simulation/viewmodels/`의 ViewModel 클래스들이 Repository로부터 받은 데이터를 UI에 맞게 올바르게 가공하는지 검증하는 단위 테스트를 작성합니다.
-   **기대 효과**: 데이터 관련 버그를 사전에 방지하고, 코드 변경에 대한 안정성을 확보합니다.
-   **검증 방법**: `pytest` 실행 시 모든 관련 테스트가 통과하는지 확인합니다.

### **과업 3.3: 설계 문서 동기화**

-   **목표**: 프로젝트의 현재 상태와 설계 사상이 일치하도록 문서를 최신화하여, 새로운 팀원이 합류하거나 미래에 유지보수할 때 혼선을 방지합니다.
-   **주요 구현 내용**:
    1.  `design` 폴더 내의 모든 `.md` 파일을 검토합니다.
    2.  최근 DB/MVVM 아키텍처 변경사항이 반영되지 않은 오래된 문서는 내용을 수정하거나, `design/legacy` 폴더로 이동시킵니다.
-   **기대 효과**: 프로젝트의 기술적 부채를 줄이고, 지식 관리의 효율성을 높입니다.
-   **검증 방법**: 주요 아키텍처 문서(`MASTER_PLAN.md`, `PROJECT_API_DESIGN.md` 등)가 현재 코드 구조와 일치하는지 동료 검토(Peer Review)를 진행합니다.
