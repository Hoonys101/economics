# 가계 투기적/완충재 수요 도입 계획 (Household Speculative/Buffer Demand Introduction Plan)

## 1. 문제 인식 (Problem Recognition)

현재 시뮬레이션 모델은 'food' 시장에서 수요-공급 법칙을 완전히 지지하지 않는 것으로 확인되었습니다. 주요 원인은 가계의 식량 수요가 즉각적인 생존 욕구에만 엄격하게 연동되어 있어, 가격 변화에 대한 수요 탄력성이 매우 낮거나 거의 없기 때문입니다. 기업이 공급을 늘리고 가격을 낮추더라도, 가계는 생존 욕구가 충족되거나 인벤토리가 충분하면 추가 구매를 하지 않아 시장의 초과 공급이 해소되지 않고 거래량이 유의미하게 증가하지 않습니다.

## 2. 목표 (Goal)

가계 에이전트의 식량 수요에 가격 탄력성 및 완충재 기반의 투기적 구매 행동을 도입하여, 시뮬레이션 모델이 경제학의 수요-공급 법칙을 더 현실적으로 반영하도록 개선합니다. 이는 AI 에이전트가 시장 기회(저렴한 가격) 또는 장기적 안정성(인벤토리 완충)을 고려하여 의사결정을 내리도록 유도합니다.

## 3. 해결 방법 (Solution Method): 새로운 AI Tactic 도입

단순히 기존 로직에 투기적 수요를 하드코딩하는 대신, V2 AI 모델 설계 원칙에 따라 이를 새로운 AI Tactic으로 정의하고, AI가 이 Tactic을 학습하여 적절한 시점에 사용하도록 합니다. 이는 AI의 의사결정을 고수준 전략적 수준으로 유지하고, AI가 언제 이러한 행동에 참여할지 학습하도록 합니다.

### 3.1. `simulation/ai/enums.py` 수정

*   [x] `Tactic` Enum에 새로운 멤버 추가:
    *   `BUY_FOR_BUFFER`: 가격이 유리할 때 필수품(예: food)의 인벤토리 완충재를 채우기 위한 구매 행동.

### 3.2. `HouseholdAI` (또는 `AIDecisionEngine`) 수정

`HouseholdAI`는 `AIDecisionEngine`을 통해 의사결정을 내리므로, 이 새로운 Tactic을 학습하고 선택할 수 있도록 다음을 수정합니다.

*   [x] **상태(State) 정의 업데이트:**
    *   AI의 상태 표현에 관련 시장 가격 신호(예: 현재 가격이 역사적 평균 또는 인지된 공정 가격 대비 낮은지 여부) 및 현재 인벤토리 수준(특히 필수품 완충재 대비)을 더 명시적으로 포함합니다.
    *   예: `(자산 수준, 재고 수준, 주요 욕구, 시장_가격_상태)`
*   [x] **행동(Action) 공간 업데이트:**
    *   AI의 행동 공간에 새로 정의된 `BUY_FOR_BUFFER` Tactic을 추가합니다.
*   [x] **보상(Reward) 메커니즘 정의:**
    *   `BUY_FOR_BUFFER` Tactic을 선택했을 때의 보상 메커니즘을 정의합니다. 예를 들어, 낮은 가격에 구매하여 미래에 높은 가격으로 구매하는 것을 회피하거나, 인벤토리 완충재를 유지하여 생존 욕구의 급격한 증가를 방지하는 것과 연관된 긍정적 보상을 부여할 수 있습니다.

### 3.3. `HouseholdDecisionEngine._execute_tactic` 수정

`_execute_tactic` 메서드에 `Tactic.BUY_FOR_BUFFER`에 대한 구체적인 실행 로직을 구현합니다.

*   [x] **`Tactic.BUY_FOR_BUFFER` 로직:**
    *   **`target_buffer_quantity` 계산:** 필수품(예: food)에 대한 목표 완충 수량을 계산합니다. 이는 `config.py`의 새로운 설정값을 참조할 수 있습니다.
    *   **현재 인벤토리와 완충재 비교:** 현재 인벤토리가 목표 완충 수량보다 낮은지 확인합니다.
    *   **시장 가격 평가:** 현재 시장 가격(`goods_market.get_best_ask('food')`)이 가계가 인지하는 공정 가격(`perceived_avg_prices`) 또는 역사적 평균보다 낮은지 평가합니다.
    *   **`BUY` 주문 생성:** 위 조건(인벤토리 부족, 유리한 가격)이 충족되고 가계가 구매할 여유가 있다면, `BUY` 주문을 생성합니다. 이 구매 수량은 `target_buffer_quantity`를 채우는 데 필요한 양과 `FOOD_PURCHASE_MAX_PER_TICK`에 의해 제한됩니다.

### 3.4. `config.py` 업데이트

새로운 행동 로직을 지원하기 위해 `config.py`에 다음 매개변수를 추가합니다.

*   [x] `TARGET_FOOD_BUFFER_QUANTITY`: 가계가 목표로 하는 식량 완충 재고량.
*   [x] `PERCEIVED_FAIR_PRICE_THRESHOLD_FACTOR`: 인지된 공정 가격 대비 얼마나 낮아야 투기적 구매를 고려할지 결정하는 요소.

## 4. 검증 방법 (Verification Method)

이 변경 사항이 적용된 후, 'food' 공급량을 인위적으로 늘리는 실험을 다시 수행하여 다음을 확인합니다.

*   공급 증가 시 'food'의 시장 가격이 더 명확하게 하락하는지.
*   공급 증가 시 'food'의 거래량이 유의미하게 증가하는지.
*   가계의 인벤토리 수준이 가격 변화에 더 반응적으로 변하는지.

## 5. 인사이트/교훈 (Insight/Lesson Learned)

AI 에이전트의 행동 모델링 시, 단순히 즉각적인 효용/욕구 충족을 넘어 시장 기회나 장기적 안정성을 고려하는 전략적 행동을 도입하는 것이 시뮬레이션의 현실성과 경제학적 원리 반영에 중요합니다. 이를 위해 AI의 Tactic 시스템을 확장하는 것이 효과적인 방법입니다.
