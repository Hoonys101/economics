🕵️  Reviewing Code with instruction: 'Analyze this PR.'...
📖 Attached context: C:\coding\economics\design\gemini_output\pr_diff_infra-cleanup-td-063-050-051-1168830734155576498.txt
🚀 [GeminiWorker] Running task with manual: git_reviewer.md

📝 [Review Report]
============================================================
# 🔍 Git Diff Review: Infra-Cleanup & Architectural Regression

## 1. 🔍 Summary

이 PR은 경로 수정, 문서 ID 통일 등 인프라 정리 작업을 목표로 하고 있습니다. 하지만, 이 과정에서 **`Firm` 모델의 SoC(Separation of Concerns) 리팩토링(TD-067)을 완전히 되돌리는 심각한 아키텍처 퇴행**이 포함되었습니다. `CorporateManager`가 `FinanceDepartment`와 같은 하위 컴포넌트를 우회하여 `firm.assets`를 직접 조작하도록 변경되었으며, `Firm` 클래스에 수십 개의 wrapper 속성이 다시 추가되었습니다.

## 2. 🚨 Critical Issues

-   **[CRITICAL] 아키텍처 원칙 위반 및 SoC(관심사 분리) 퇴행**:
    -   **파일**: `simulation/decisions/corporate_manager.py` (전체)
    -   **문제점**: 이 파일의 거의 모든 변경 사항이 이전에 분리된 `FinanceDepartment`, `ProductionDepartment` 등의 책임을 다시 침범합니다. `firm.finance.invest_in_automation(budget)`과 같은 캡슐화된 메서드 호출을 `firm.assets -= budget`과 같은 직접적인 상태 조작으로 되돌렸습니다. 이는 **TD-067의 목표를 정면으로 위반**하는 심각한 설계 결함입니다.
    -   **예시**: `corporate_manager.py`, line 223: `firm.assets -= actual_spend`

-   **[CRITICAL] 자산 무결성 파괴 (Potential Money Leak Bug)**:
    -   **파일**: `simulation/decisions/corporate_manager.py`
    -   **문제점**: `FinanceDepartment`의 `invest_in_automation`, `invest_in_rd`, `pay_severance` 등의 메서드에는 자산이 충분한지 확인하는 로직(`if self.firm.assets >= amount`)이 포함되어 있었습니다. 이를 무시하고 `firm.assets -= budget`으로 직접 자산을 차감하면서, **자산이 음수가 될 수 있는 치명적인 버그**가 발생할 수 있습니다. 이는 시스템의 Zero-Sum 원칙을 위반할 수 있습니다.

-   **[CRITICAL] "God Class" 패턴 회귀**:
    -   **파일**: `simulation/firms.py`
    -   **문제점**: `TD-067`의 핵심 목표 중 하나인 "Wrapper Properties 제거"와는 반대로, 약 **150라인에 걸쳐 수많은 `@property` wrapper가 `Firm` 클래스에 추가**되었습니다. (`employees`, `retained_earnings`, `revenue_this_turn` 등). 이는 `Firm` 클래스를 다시 거대한 Facade이자 God Class로 되돌리는 명백한 아키텍처 퇴행입니다.

## 3. ⚠️ Logic & Spec Gaps

-   **작업 범위 불일치**: PR의 의도(Infra-Cleanup: TD-050, TD-063, TD-051)와 실제 코드 변경(TD-067 아키텍처 파괴)이 전혀 일치하지 않습니다. 개발자가 두 개의 다른 작업을 하나의 커밋에 혼합했으며, 아키텍처 변경의 의도를 완전히 오해한 것으로 보입니다.
-   **컴포넌트 책임 제거**: `simulation/components/finance_department.py` 등에서 `invest_in_automation` 과 같은 핵심 메서드들이 삭제되었습니다. 이는 컴포넌트의 책임을 없애고 다시 `Firm`과 `CorporateManager`에 모든 로직을 중앙화시키는 잘못된 방향입니다.

## 4. 💡 Suggestions

-   **PR 분리**: 이 PR은 즉시 2개로 분리해야 합니다.
    1.  **[허용] 인프라 정리**: `scripts/` 내의 모든 `sys.path`를 `pathlib`으로 변경하고, 문서의 `WO-XXX` 플레이스홀더를 교체하는 변경 사항만 포함된 PR. 이 부분은 긍정적인 개선입니다.
    2.  **[거부] 아키텍처 퇴행**: `simulation/firms.py`, `simulation/decisions/corporate_manager.py`, `simulation/components/*.py`에 대한 모든 변경 사항은 **즉시 폐기(revert)**해야 합니다.
-   **개발자 재교육**: 이 코드를 작성한 개발자는 `TD-067`과 SoC(관심사 분리) 원칙의 중요성에 대해 다시 명세서를 숙지해야 합니다. 왜 `Firm` 클래스를 여러 `Department`로 분리했는지 근본적인 이유를 이해하는 것이 시급합니다.

## 5. ✅ Verdict

-   **REJECT**

이 PR은 사소한 인프라 개선을 포함하고 있지만, 프로젝트의 핵심 아키텍처를 심각하게 훼손하고 치명적인 버그를 유발할 가능성이 매우 높습니다. 제안된 대로 PR을 분리하고 아키텍처를 파괴하는 모든 변경 사항을 폐기하기 전에는 절대 머지해서는 안 됩니다.

============================================================
