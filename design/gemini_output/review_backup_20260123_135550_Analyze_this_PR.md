# 🔍 Git Diff Review: WO-115 Great Reset Stability Verification

---

### 🔍 Summary

이 PR은 `WO-115` 작업 지시에 따라, 시스템의 장기 안정성을 검증하기 위한 스트레스 테스트 스크립트(`verify_great_reset_stability.py`)를 도입합니다. 이 스크립트는 시뮬레이션의 원자성, 화폐 공급의 무결성(Zero-Sum), 재정 안정성을 성공적으로 측정했으며, 그 과정에서 심각한 시스템 버그를 발견했습니다. 또한, 여러 모듈에 걸쳐 직접적인 자산 수정을 `deposit`/`withdraw` 메소드 호출로 변경하는 중요한 리팩토링을 포함하여 코드의 정합성을 향상시켰습니다.

---

### 🚨 Critical Issues

-   **CRITICAL: 심각한 화폐 누수 (Zero-Sum 위반) 발견**
    - **파일**: `reports/GREAT_RESET_REPORT.md`, `scripts/verify_great_reset_stability.py`
    - **문제**: 새로 추가된 검증 스크립트의 실행 결과, **`959,661.61`** 이라는 막대한 양의 "설명할 수 없는 자금 변동(Unexplained Drift)"이 발생한 것이 `GREAT_RESET_REPORT.md`에 기록되었습니다. 이는 시스템 내 어딘가에서 자산이 의도치 않게 생성되거나 소멸하는, 심각한 **돈 복사/누수 버그**가 존재함을 의미합니다.
    - **영향**: 이 버그는 시스템의 경제적 기반을 신뢰할 수 없게 만들며, 모든 재무 관련 데이터의 정합성을 훼손합니다.

---

### ⚠️ Logic & Spec Gaps

-   **검증의 성공, 시스템의 실패**: 이 PR의 목표는 안정성 "검증"이었으며, 새로 추가된 스크립트는 시스템이 **불안정함**을 성공적으로 "검증"해냈습니다. 코드 변경 자체의 논리에는 결함이 없으나, 그 결과가 시스템의 근본적인 결함을 드러냈습니다. 따라서 현재 상태로 병합하는 것은 '실패한 테스트'를 코드베이스에 추가하는 것과 같습니다.

---

### 💡 Suggestions

1.  **검증 스크립트의 실패 처리 강화**:
    - **파일**: `scripts/verify_great_reset_stability.py`
    - **제안**: 현재 스크립트는 `ZERO_SUM_DRIFT` 경고를 로깅하지만, `sys.exit(0)`으로 성공 코드를 반환합니다. 이는 CI/CD 파이프라인에서 버그를 탐지하지 못하게 할 수 있습니다. 상당한 `drift`가 감지되면 `sys.exit(1)`을 반환하여 명시적인 실패로 처리하도록 수정하는 것을 강력히 권장합니다.

2.  **캡슐화 원칙 준수**:
    - **파일**: `scripts/verify_great_reset_stability.py` (lines 74-85)
    - **제안**: 자산 총계를 계산할 때 `h.create_state_dto().assets`와 같이 DTO나 public 인터페이스를 사용하도록 개선한 점은 매우 훌륭합니다. 이는 이 PR의 다른 부분에서 진행된 리팩토링(`assets -=` -> `withdraw()`)과 방향성이 일치하며, 좋은 아키텍처 관행입니다.

---

### ✅ Verdict

**REQUEST CHANGES**

**이유**: 이 PR은 두 가지 중요한 기여를 했습니다. 첫째, 시스템의 정합성을 강화하는 훌륭한 리팩토링을 다수 포함하고 있습니다. 둘째, 매우 중요한 안정성 검증 스크립트를 도입하여, 그 결과로 **치명적인 화폐 누수 버그를 성공적으로 발견**했습니다.

그러나 발견된 버그가 매우 심각하므로, 이 PR을 현재 상태로 병합할 수 없습니다. 이 PR의 목적은 '안정성 확보'로 전환되어야 합니다.

**요청 사항:**
1.  `verify_great_reset_stability.py` 스크립트를 사용하여 발견된 화폐 누수 버그의 근본 원인을 추적하고 수정하십시오.
2.  버그 수정 후, `GREAT_RESET_REPORT.md`에 `Unexplained Drift`가 허용 오차 범위 내(예: `< 1.0`)로 들어오는 것을 확인하고 그 결과를 포함하여 PR을 다시 제출해주십시오.
