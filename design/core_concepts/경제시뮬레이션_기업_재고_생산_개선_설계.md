# 경제 시뮬레이션 설계서: 기업 재고 및 생산 로직 개선

**버전**: v0.1
**작성일자**: 2025-07-05
**관련 문서**: `경제시뮬레이션_시장_및_상호작용_설계.md`

---

## 1. 개요

본 문서는 현재 시뮬레이션에서 기업 주체의 재고 관리 및 생산 의사결정 로직의 비효율성을 개선하기 위한 설계안을 제시한다. 특히, 재고가 음수가 되는 문제와 생산 목표의 부재를 해결하여 기업의 행동을 더욱 현실적이고 합리적으로 만든다.

---

## 2. 개선 목표

- 기업이 재고가 없는 상품에 대해 판매 주문을 내지 않도록 한다.
- 기업이 특정 재고 목표를 설정하고, 이를 달성하기 위해 생산량을 조절하도록 한다.
- 기업의 생산 품목을 `goods.json`에 정의된 모든 재화로 확장하여 시뮬레이션의 다양성을 높인다.

---

## 3. 상세 설계

### 3.1. 기업의 판매 의사결정 (`FirmDecisionEngine` 수정)

- **현재 문제점**: `FirmDecisionEngine`에서 기업이 재고 여부와 상관없이 판매 주문을 내어 재고가 음수가 되는 문제가 발생한다.
- **개선 방안**:
    - `FirmDecisionEngine`의 `make_decisions` 메서드 내에서 판매 주문을 생성하기 전에, 해당 상품의 현재 재고를 확인한다.
    - `firm.inventory.get(good['id'], 0)` 값이 0보다 클 경우에만 판매 주문을 생성하도록 조건을 추가한다.
    - 판매 수량도 현재 재고를 초과하지 않도록 조정한다. (예: `min(firm.inventory.get(good['id'], 0), 판매_목표_수량)`)

### 3.2. 기업의 생산 의사결정 (`Firm` 및 `FirmDecisionEngine` 수정)

- **현재 문제점**: 기업의 생산이 단순히 고용된 노동력에 비례하며, 특정 재고 목표나 시장 수요를 반영하지 않는다. 또한, 생산 품목이 'food'로 고정되어 있다.
- **개선 방안**:
    - **`Firm` 클래스에 `production_targets` 속성 추가**:
        - `production_targets: Dict[str, float]` 형태로, 각 재화 ID에 대한 목표 재고량을 저장한다. (예: `{"food": 100, "luxury_food": 50}`)
        - 초기화 시 `main.py` 또는 `config.py`에서 설정할 수 있도록 한다.
    - **`FirmDecisionEngine`에서 생산 계획 수립**:
        - `make_decisions` 메서드 내에서 각 `production_targets`에 대해 현재 재고와 비교하여 생산 필요량을 계산한다.
        - 생산 필요량에 따라 노동력 수요를 결정하거나, 생산된 재화를 시장에 공급하는 전략을 수립한다.
        - **생산 품목 다양화**: `goods_data`를 활용하여 기업이 여러 종류의 재화를 생산할 수 있도록 한다. 기업 생성 시 어떤 재화를 생산할지 랜덤하게 선택하거나, 설정 파일에서 지정하도록 한다.
    - **`Firm` 클래스의 `produce` 메서드 수정**:
        - `production_target_item` 대신 `production_targets`를 기반으로 여러 재화를 생산할 수 있도록 로직을 변경한다.
        - 생산량은 여전히 고용된 노동력에 비례하지만, 목표 재고량을 고려하여 생산량을 조절할 수 있도록 한다. (예: 목표 재고량에 도달하면 생산 중단 또는 감소)

### 3.3. 기업 주체 (Firm Agent) 핵심 속성

기업 주체는 시뮬레이션 내에서 생산과 고용의 주체로서 다양한 속성을 가집니다. 특히, 의사결정 로직을 외부에서 주입받는 `decision_engine` 속성을 통해 유연한 행동 패턴을 구현합니다.

#### 3.3.1 속성

| 속성명 | 설명 | 타입 |
|--------|------|------|
| `id` | 기업의 고유 식별자 | `int` |
| `initial_capital` | 기업의 초기 자본 | `float` |
| `initial_liquidity_need` | 기업의 초기 화폐 보유 욕구 | `float` |
| `production_targets` | 각 재화 ID에 대한 목표 재고량 | `Dict[str, float]` |
| `value_orientation` | 기업의 가치관 (AI 의사결정 모델 선택에 영향) | `str` |
| `productivity_factor` | 기업의 생산성 (노동 1단위당 생산량) | `float` |
| `decision_engine` | 기업의 의사결정을 담당하는 엔진 (AI 또는 규칙 기반) | `FirmDecisionEngine` 객체 |
| `assets` | 기업의 현재 자산 | `float` |
| `inventory` | 기업이 보유한 재화 목록 및 수량 | `Dict[str, float]` |
| `employees` | 현재 고용된 가계 에이전트 목록 | `List[Household]` |
| `total_shares` | 발행된 총 주식 수 | `float` |
| `is_active` | 기업의 활동 여부 | `bool` |
| `revenue_this_turn` | 현재 턴의 총 수익 | `float` |
| `cost_this_turn` | 현재 턴의 총 비용 | `float` |
| `current_profit` | 현재 턴의 이익 (수익 - 비용) | `float` |
| `consecutive_loss_turns` | 연속 적자 턴 수 | `int` |

#### 3.3.2 생성자 (Constructor)

`Firm` 객체는 다음 인자들을 통해 초기화됩니다.

```python
class Firm:
    def __init__(self, id: int, initial_capital: float, initial_liquidity_need: float,
                 production_targets: Dict[str, float], value_orientation: str,
                 productivity_factor: float, decision_engine: 'FirmDecisionEngine'):
        # ... (속성 초기화 로직)
```

### 3.4. 시뮬레이션 파라미터 분리 (`config.py` 생성)

- **현재 문제점**: `main.py`에 시뮬레이션의 주요 파라미터(가계 수, 기업 수, 초기 자산 범위 등)가 하드코딩되어 있어 수정이 번거롭다.
- **개선 방안**:
    - 프로젝트 루트에 `config.py` 파일을 생성한다.
    - `main.py`에 있는 모든 시뮬레이션 관련 파라미터들을 `config.py`로 이동시킨다.
    - `main.py` 및 필요한 다른 모듈에서 `config.py`를 임포트하여 파라미터에 접근하도록 수정한다.

---

## 4. 구현 계획

1.  `design/경제시뮬레이션_기업_재고_생산_개선_설계.md` 파일 생성 (현재 단계).
2.  `simulation/firms.py` 파일 수정: `Firm` 클래스에 `production_targets` 속성 추가.
3.  `simulation/decisions.py` 파일 수정: `FirmDecisionEngine`의 `make_decisions` 메서드에서 판매 및 생산 로직 개선.
4.  `config.py` 파일 생성 및 시뮬레이션 파라미터 이동.
5.  `main.py` 및 관련 파일에서 `config.py` 임포트 및 파라미터 사용하도록 수정.
6.  테스트 실행 및 결과 확인.

---
