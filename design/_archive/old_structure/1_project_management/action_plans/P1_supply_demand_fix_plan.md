### 기획안: 수요-공급 법칙 검증 실패 문제 해결

**1. 문제 정의**

`MASTER_PLAN.md`에 기록된 바와 같이, 시뮬레이션의 핵심 경제 모델이 현실의 기본 경제 원칙을 따르는지 확인하기 위해 'food'의 초기 공급량을 인위적으로 늘리는 실험을 진행했습니다. 경제학 원리에 따르면, 공급이 증가하면 시장 가격은 하락하고 거래량은 증가해야 합니다. 그러나 실험 결과, 이러한 현상이 명확하게 나타나지 않았습니다. 이는 시뮬레이션의 시장 매커니즘, 기업의 가격 책정 로직, 또는 가계의 구매 결정 로직에 근본적인 결함이 있음을 시사합니다.

**2. 목표**

수요-공급 법칙이 시뮬레이션 내에서 올바르게 작동하지 않는 원인을 규명하고, 관련 로직을 수정하여 모델의 경제적 현실성을 확보하는 것을 목표로 합니다.

**3. 가설 및 조사 전략**

문제의 원인을 체계적으로 파악하기 위해 다음과 같은 가설을 설정하고, 각 가설을 검증하는 방식으로 조사를 진행합니다.

*   **가설 1: 기업의 가격 책정 로직 결함**
    *   **내용:** 재고가 쌓여도 기업들이 상품 가격을 충분히 또는 빠르게 인하하지 않는다. 가격 조정 로직이 너무 경직되어 있거나, 재고 수준을 올바르게 반영하지 못할 수 있습니다.
    *   **검증:** 실험 중 기업의 재고량, 생산 목표, 그리고 다음 틱에 제시하는 판매 가격(ask price)을 집중적으로 로깅하여 상관관계를 분석합니다.

*   [x] **가설 2: 가계의 구매 결정 로직 결함 (해결됨)**
    *   **내용:** 시장 가격이 하락해도 가계가 더 많은 상품을 구매하지 않는다. 가계의 수요가 가격 변화에 탄력적이지 않고, 다른 요인(예: 고정된 필요량)에 의해 경직되어 있을 수 있습니다.
    *   **해결:** 가계의 투기적/완충재 수요 로직을 도입하여, 가격이 유리할 때 생존 욕구 외에도 식량을 비축하도록 수정했습니다. (`household_speculative_demand_plan.md` 참조)

*   **가설 3: 시장의 주문 매칭 메커니즘 결함**
    *   **내용:** 체결 가능한 매수/매도 주문이 오더북에 존재함에도 불구하고, 시장의 매칭 알고리즘이 이를 올바르게 거래로 성사시키지 못한다.
    *   **검증:** 매 틱(tick)마다 오더북의 상태(모든 매수/매도 주문)와 최종 체결된 거래 내역을 비교하여, 매칭되어야 했으나 누락된 거래가 있는지 분석합니다.

*   **가설 4: 데이터 로깅 또는 분석 오류**
    *   **내용:** 시뮬레이션은 정상적으로 작동하지만, 최종 결과(`results_experiment.csv`)를 생성하는 과정에서 데이터가 잘못 집계되거나 누락되어 분석에 오류를 유발한다.
    *   **검증:** 시뮬레이션 중 발생하는 모든 거래(Transaction) 로그와 최종 결과 파일의 데이터를 비교하여 일치 여부를 확인합니다.

**4. 상세 실행 계획**

1.  **실험 환경 준비 및 상세 로깅 추가:**
    *   `run_experiment.py` 또는 관련 스크립트를 분석하여 'food'의 초기 공급량을 늘리는 실험을 재현할 수 있는 방법을 파악합니다.
    *   가설 검증을 위해 아래 위치에 상세한 로그를 추가합니다.
        *   `FirmDecisionEngine`: 재고, 생산 목표, 계산된 판매 가격
        *   `HouseholdDecisionEngine`: 현재 욕구, 자산, 계산된 구매 수량 및 가격
        *   `OrderBookMarket`: 매 틱의 주문 매칭 전/후 오더북 상태

2.  **실험 재현 및 로그 분석:**
    *   수정된 로깅 로직을 적용하여 'food' 공급 증가 실험을 다시 실행합니다.
    *   수집된 로그를 바탕으로 위에서 설정한 4가지 가설을 순서대로 분석하여 문제의 원인을 특정합니다. 가계의 가격 비탄력적 수요(가설 2)가 가장 유력한 원인으로 추정되므로 우선적으로 검토합니다.

3.  **코드 수정 및 단위 테스트:**
    *   분석을 통해 파악된 원인을 해결하기 위해 관련 코드(`DecisionEngine` 또는 `Market` 등)를 수정합니다.
    *   수정한 로직이 의도대로 작동하는지 확인하기 위한 단위 테스트를 작성하거나 기존 테스트를 보강합니다.

4.  **최종 검증:**
    *   수정된 코드로 다시 한번 'food' 공급 증가 실험을 실행합니다.
    *   결과 분석을 통해 시장 가격이 하락하고 거래량이 증가하는, 수요-공급 법칙에 부합하는 결과가 나타나는지 최종 확인합니다.

**5. 문서화**

이 모든 과정과 최종 해결책을 `design/1_project_management/action_plans/P1_supply_demand_fix_plan.md`와 `design/5_troubleshooting/troubleshooting_guide.md`에 상세히 기록하여 지식을 축적합니다.

