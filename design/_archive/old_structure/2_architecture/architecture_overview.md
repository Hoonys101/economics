# 아키텍처 개요 (V2)

## 1. 목표

이 문서는 V2 설계의 전체적인 기술 아키텍처와 데이터 흐름을 정의합니다. 각 컴포넌트의 역할과 상호작용을 명확히 하여, 안정적이고 확장 가능한 시뮬레이션 구조를 구축하는 것을 목표로 합니다.

## 2. 핵심 컴포넌트

- **SimulationEngine:** 시뮬레이션의 전체 틱(tick) 흐름을 관장하는 중앙 컨트롤러.
- **Agents (Firm, Household):** 경제 활동의 주체. V2 설계에서는 시장에 직접 가격을 제시하기보다, 시장의 피드백에 반응하여 행동을 결정합니다.
- **Markets (OrderBookMarket):** 주문을 접수하고 매칭하여 거래를 체결시키는 역할. V2에서는 가격 결정의 기준이 되는 피드백(예: 미체결 주문, 재고 현황)을 생성하는 역할이 강화됩니다.
- **Database (Repository):** 시뮬레이션의 모든 상태와 결과를 저장하는 영구 저장소. V2에서는 이전 틱의 시장 평균 가격, 평균 임금 등 주요 거시 지표를 다음 틱의 의사결정 기준으로 제공하는 중요한 역할을 합니다.
- **AIDecisionEngine:** 에이전트의 전략적 판단을 담당하는 두뇌. 가격 계산과 같은 저수준의 판단이 아닌, "무엇을 할 것인가"에 대한 고수준의 전략을 결정합니다.

## 3. V2 데이터 흐름 (단일 틱)

1.  **데이터 준비 (Engine):** `SimulationEngine`이 `Database`에서 이전 틱의 주요 거시 지표(`avg_wage`, `avg_goods_price` 등)를 조회하여 `market_data`를 준비합니다.

2.  **가격/임금 제시 (Firms):** `Engine`이 `market_data`를 모든 `Firm` 에이전트에게 전달합니다.
    -   기업들은 이를 바탕으로 이번 틱에 제공할 상품 가격과 직원에게 제시할 임금(wage offer)을 결정합니다.
    -   결정된 가격으로 상품 판매(SELL) 주문과 노동 구매(BUY) 주문을 `Market`에 제출합니다.

3.  **주문 수락 (Households):** `Engine`이 `market_data`와 시장에 제출된 오퍼들을 `Household` 에이전트에게 전달합니다.
    -   가계는 자신의 필요와 예산, 기대 임금에 맞춰 시장의 오퍼들을 확인합니다.
    -   가장 유리한 상품 구매(BUY) 주문과 노동 판매(SELL) 주문을 `Market`에 제출합니다.

4.  **주문 체결 (Markets):** `Market`이 접수된 모든 BUY/SELL 주문을 매칭하여 거래(Transaction)를 체결시키고, 그 결과를 `Engine`에 반환합니다.

5.  **상태 업데이트 (Engine):** `Engine`이 모든 거래 결과를 바탕으로 각 에이전트의 자산, 재고, 고용 상태 등을 업데이트합니다.

6.  **생산 및 소비 (Agents):**
    -   `Firms`는 고용된 직원을 바탕으로 상품을 생산합니다.
    -   `Households`는 구매한 상품을 소비하여 필요(needs)를 충족시킵니다.

7.  **데이터 기록 (Database):** `Engine`이 이번 틱에서 발생한 모든 거래, 에이전트 상태, 새로 계산된 거시 지표를 `Database`에 기록합니다. 이 데이터는 다음 틱의 "과거 데이터"가 됩니다.

## 5. 초기 조건과 창발적 현상 (Initial Conditions and Emergent Phenomena)

V2 아키텍처는 에이전트의 하드코딩된 '타입'이 아닌, 시뮬레이션의 **초기 조건(Initial Conditions)** 설정에 의해 다양한 거시 현상이 **창발(emerge)**하도록 설계되었습니다.

### 창발적 계급 구조

가장 대표적인 예는 '계급 구조'입니다. V2에는 '자본가'나 '노동자'와 같이 별도로 정의된 에이전트 클래스가 없습니다. 모든 가계는 동일한 `Household` 클래스입니다.

하지만 시뮬레이션 시작 시점에 **초기 자본(주식)을 어떻게 분배하는가**에 따라, 사실상의 계급이 자연스럽게 형성될 수 있습니다.

- **시나리오 예시:** 총 주식의 95%를 소수의 가계에 집중시키고, 나머지 5%를 다수의 가계에 분배합니다.
- **결과:**
    - **자본가 계급 (소수):** 막대한 배당금 수익으로 인해 노동 없이도 자산이 증식합니다. 이들의 주된 경제 활동은 '자본 관리'가 됩니다.
    - **노동자 계급 (다수):** 배당금 수익이 미미하여, 생존을 위해 반드시 노동 시장에 참여하여 임금을 벌어야 합니다. 이들의 주된 경제 활동은 '노동 제공 및 소비'가 됩니다.

이처럼, V2 아키텍처는 초기 조건의 설정을 통해 복잡하고 현실적인 경제 구조가 시뮬레이션 과정 속에서 스스로 나타나도록 하는 것을 지향합니다.
