## 경제 시뮬레이션 고도화 및 안정화 프로젝트 제안

### 1. 프로젝트 개요

본 프로젝트는 현재 개발된 `economics` AI 경제 시뮬레이션의 안정성과 사용성을 한 단계 끌어올리는 것을 목표로 합니다. 현재 시뮬레이션은 에이전트 기반 모델링, AI 의사결정, 웹 UI 등 핵심 기능의 골격은 갖추었으나, **심각한 성능 저하**, **UI 데이터 표시 오류**, **핵심 로직의 검증 부족**이라는 명확한 문제점을 안고 있습니다.

본 제안은 이러한 문제점들을 체계적으로 해결하고, 향후 기능 확장을 위한 안정적인 기반을 마련하기 위한 구체적인 실행 계획을 담고 있습니다.

### 2. 프로젝트 목표

1.  **성능 최적화:** 웹 UI를 통한 시뮬레이션 실행 속도를 실시간 분석이 가능한 수준으로 개선합니다. (현재 1틱당 약 20초 -> **1틱당 1초 미만 목표**)
2.  **UI 정확성 및 기능 강화:** UI에 표시되는 모든 경제 지표(실업률, 평균 자산 등)의 정확성을 확보하고, 데이터가 올바르게 시각화되도록 수정합니다.
3.  **핵심 로직 검증 및 안정화:** 불확실하게 동작하는 내부 로직(예: 부분 거래)을 명확히 검증하고, 코드의 안정성을 확보하여 신뢰도 높은 시뮬레이션 환경을 구축합니다.
4.  **문서화 및 테스트 기반 마련:** 코드의 유지보수성을 높이고, 향후 개발을 용이하게 하기 위해 주요 로직에 대한 문서화 및 테스트 전략의 기틀을 마련합니다.

### 3. 세부 실행 계획

#### Phase 1: 성능 최적화 (Performance Optimization)

*   **작업 1.1: 백엔드 병목 현상 해결**
    *   **내용:** `app.py`의 `run_simulation_loop` 함수 내에 있는 `time.sleep(1)` 구문을 수정하여 시뮬레이션 틱 간의 대기 시간을 대폭 단축하거나 제거합니다.
    *   **담당 파일:** `app.py`
*   **작업 1.2: 프론트엔드 업데이트 주기 조절**
    *   **내용:** 백엔드 처리 속도 개선에 맞춰, `index.html`의 JavaScript에서 API를 호출하는 주기(`setInterval`)를 0.5초 ~ 1초 사이의 합리적인 값으로 조정하여 부하를 줄이고 부드러운 UI를 제공합니다.
    *   **담당 파일:** `templates/index.html`

#### Phase 2: UI 정확성 및 안정화 (UI Accuracy & Stabilization)

*   **작업 2.1: 실업률 표시 오류 수정**
    *   **내용:** `simulation/engine.py`의 `EconomicIndicatorTracker`에서 계산된 실업률 데이터와 `app.py`의 `/api/simulation/state` 엔드포인트에서 해당 데이터를 조회하여 UI에 전달하는 로직을 전면 재검토하고 수정합니다.
    *   **담당 파일:** `simulation/engine.py`, `app.py`
*   **작업 2.2: 평균 자산 분리 표시**
    *   **내용:** `app.py`의 `get_simulation_state` 함수에서 '가계 평균 자산'과 '기업 평균 자산'을 명확히 분리하여 계산하도록 로직을 수정하고, `templates/index.html`에서 이 두 지표를 별도의 항목으로 표시하도록 업데이트합니다.
    *   **담당 파일:** `app.py`, `templates/index.html`
*   **작업 2.3: 고정 데이터(N/A, 0) 문제 해결**
    *   **내용:** '최고 판매 상품', '기업 평균 욕구' 등이 고정된 값으로 표시되는 문제를 해결하기 위해, `app.py`의 `get_simulation_state` 함수 내 관련 데이터 집계 로직을 디버깅하고 수정합니다.
    *   **담당 파일:** `app.py`

#### Phase 3: 핵심 로직 검증 및 안정화 (Core Logic Verification)

*   **작업 3.1: 부분 거래(Partial Fulfillment) 로직 검증**
    *   **내용:** `simulation/markets.py`의 `match_orders` 메소드 내에, 주문량이 부분적으로 체결되는 모든 경우(예: `buy_order.quantity > sell_order.quantity`)에 상세 로그를 기록하도록 `logger`를 추가합니다. 이후 시뮬레이션을 실행하여 해당 로그가 정상적으로 발생하는지 분석하고, 부분 거래 로직의 정확성을 검증합니다.
    *   **담당 파일:** `simulation/markets.py`
*   **작업 3.2: 에이전트 생멸(Lifecycle) 조건 검증**
    *   **내용:** `simulation/engine.py`의 `_handle_agent_lifecycle` 함수 내에서 가계의 사망 또는 기업의 폐업 조건이 충족되는 순간을 특정하여 로그를 기록합니다. 이를 통해 에이전트들이 설계된 조건에 따라 정확하게 시뮬레이션에서 제거되는지 확인합니다.
    *   **담당 파일:** `simulation/engine.py`

### 4. 기대 효과

*   **사용성 향상:** 사용자는 웹 UI를 통해 빠르고 쾌적하게 시뮬레이션 결과를 실시간으로 확인할 수 있습니다.
*   **신뢰성 확보:** UI에 표시되는 모든 데이터의 정확성을 보장하여, 사용자가 시뮬레이션 결과를 신뢰하고 분석에 활용할 수 있게 됩니다.
*   **안정적인 개발 기반:** 핵심 로직의 검증과 안정화를 통해, 향후 새로운 기능(금융 시스템, 정부 정책 등)을 추가할 때 발생할 수 있는 잠재적 오류를 최소화하고 개발 속도를 높일 수 있습니다.

---

### 기획안에 대한 자체 평가

#### 긍정적인 측면 (강점)

1.  **문제 중심적 접근:** 현재 프로젝트가 직면한 가장 시급하고 명확한 문제점(성능, UI 오류, 로직 불확실성)에 직접적으로 초점을 맞추고 있어, 제한된 자원으로 최대의 효과를 낼 수 있습니다.
2.  **실행 가능성:** 새로운 기능을 개발하는 것이 아니라 기존 코드를 수정하고 검증하는 작업이 대부분이므로, 현재 코드베이스에 대한 이해를 바탕으로 단기간 내에 완료할 수 있는 현실적인 계획입니다.
3.  **단계적 접근:** `성능 -> UI -> 로직` 순서의 단계적 계획은 각 단계의 성공 여부를 명확히 확인하며 안정적으로 프로젝트를 진행할 수 있게 합니다. 예를 들어, 성능 문제가 해결되어야 UI 테스트를 원활하게 진행할 수 있습니다.

#### 보완점 및 리스크

1.  **테스트의 한계:** 현재 계획은 `로그 분석`을 통한 수동적 검증에 크게 의존하고 있습니다. 장기적인 관점에서는 `pytest` 등을 활용한 단위 테스트(Unit Test) 및 통합 테스트(Integration Test) 코드를 작성하여, 변경 사항이 발생할 때마다 자동으로 코드의 안정성을 검증하는 시스템을 구축할 필요가 있습니다.
2.  **근본적인 설계 결함 가능성:** 본 계획은 현재 로직의 '구현 오류'를 수정하는 데 초점을 맞추고 있습니다. 만약 성능 저하나 UI 오류의 원인이 단순한 구현 실수가 아닌, 데이터 흐름이나 아키텍처의 근본적인 설계 결함에 있다면, 수정에 예상보다 더 많은 시간이 소요될 수 있습니다. Phase 2, 3의 디버깅 과정에서 이러한 문제가 발견될 경우, 추가적인 설계 변경 논의가 필요할 수 있습니다.

### 최종 결론

본 기획안은 현재 `economics` 프로젝트의 문제점을 해결하고 안정적인 다음 단계로 나아가기 위한 필수적인 계획입니다. 제시된 계획을 성공적으로 수행하면, 프로젝트는 **신뢰할 수 있고 사용성 높은 시뮬레이션**으로 거듭날 것이며, 이는 향후 더 복잡하고 정교한 경제 모델을 탐구하기 위한 튼튼한 발판이 될 것입니다.
