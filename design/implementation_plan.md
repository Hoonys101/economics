# Jules 전용 구현 지침 및 로드맵 (Safe Delegation Protocol)

이 문서는 Jules가 시뮬레이션의 핵심 로직을 확장할 때 발생할 수 있는 부작용을 최소화하고, 안정적으로 기능을 추가하기 위한 전략적 가이드라인입니다. 모든 작업은 **위험도가 낮은 단계부터** 순차적으로 진행하며, 각 단계마다 정의된 **안전 프로토콜**을 준수해야 합니다.

---

## 🛡️ 공용 안전 프로토콜 (Mandatory)
- **R-2.1 (선설계 후구현)**: 모든 작업 착수 전 `Sequential Thinking`을 통해 로직을 설계하고 승인을 받는다.
- **R-4.1 (API 계약 우선)**: 모듈 수정 전 `api.py` 또는 DTO를 먼저 정의하여 인터페이스 계층을 고정한다.
- **R-5.1 (TDD)**: 기능 구현 전 최소 1개의 실패하는 테스트 케이스를 먼저 작성한다.
- **R-6.1 (즉각 중단)**: 명세서(spec.md)의 의도가 모호하거나 기존 경제 균형이 무너질 징후가 보이면 즉시 작업을 중단하고 보고한다.

---

## 🟢 1단계: 저위험 (Stability & Visualization)
*시스템의 핵심 로직을 건드리지 않고 관찰력과 정적 안정성을 높이는 단계*

### 1. 타입 안정성 확보 (Mypy Errors)
- **지침**: 로직은 절대 변경하지 않는다. `Optional`, `Dict`, `List` 등의 타입 힌트만 수정한다.
- **검증**: 파일 수정 마다 `mypy <file>`를 실행하여 에러가 0인지 확인한다.

### 2. 극한 상황 테스트 (Edge Case Testing)
- **지침**: `tests/disaster/` 전용 폴더를 생성하여 하이퍼인플레이션, 가계 전멸 등의 시나리오를 코드로 작성한다.
- **검증**: 기존 엔진 코드를 수정하지 않고 테스트 스크립트만으로 상황을 유도한다.

### 3. 시장 네트워크 시각화
- **지침**: `engine.py`에 사이드 이펙트를 주지 않는 전용 ViewModel(`NetworkViewModel`)을 구현한다.
- **검증**: 대시보드 API 응답에 새로운 필드를 추가하되 기존 필드 데이터가 변하지 않음을 확인한다.

---

## 🟡 2단계: 중위험 (Agent Logic & Tuning)
*개별 에이전트의 내부 의사결정 방식에 변화를 주는 단계*

### 4. 분열(Mitosis) 메커니즘 튜닝
- **지침**: 인구 유지의 안정성을 위해 분열 임계값(`ASSET_THRESHOLD`)을 동적으로 조정하는 로직을 추가한다.
- **검증**: 1000틱 이상 시뮬레이션 시 인구수가 특정 범위 내에서 유지(Steady State)되는지 확인한다.

### 5. 사회적 유전 (Social Inheritance)
- **지침**: 부모 에이전트의 지위와 특정 기업 선호도를 자식 에이전트의 `inventory`나 `personality`에 복사하는 로직을 구현한다.
- **검증**: 세대 교체 후에도 상권의 특징이 유지되는지 확인한다.

### 6. 고도화된 욕구 계층 (Maslow's Model)
- **지침**: `Household.update_needs` 내에서 자산 수준에 따라 특정 욕구의 증가율을 조정한다.
- **검증**: 부유층 에이전트가 생존재보다 사치재를 더 많이 구매하는 행동 패턴을 보인다.

---

## 🔴 3단계: 고위험 (Structural & Macro-Economic)
*시스템의 전체 경제 균형(Global Balance)과 엔티티 구조를 변경하는 단계*

### 7. 브랜드 가치 및 품질 차별화
- **지침**: 기업에 `quality` 속성을 추가하고, 가계의 유틸리티 계산식에 이를 반영한다.
- **주의**: 품질이 가격 결정력을 지나치게 장악하여 독점이 발생하지 않도록 감시한다.

### 8. 적응형 가격 기대치 (Inflation Perception)
- **지침**: 에이전트 메모리에 과거 3~5틱의 가격 평균을 저장하고, `perceived_price` 계산식을 고도화한다.
- **주의**: 가격 변동성이 폭증(Oscillation)하여 시뮬레이션이 붕괴될 위험이 크므로 Golden Sample 검증 필수.

### 9. 기업 인수합병 (Corporate M&A)
- **지침**: 파산 조건 발생 시 삭제 대신 `Simulation.merge_firms(winner, loser)`를 호출하여 자산을 통합한다.
- **주의**: ID 참조 오류(Broken Reference)가 발생하기 쉬운 가장 위험한 단계이다.

### 10. 통화 정책 (Central Bank)
- **지침**: `Government` 에이전트 외에 `CentralBank`를 독립 엔티티로 생성하고 시장 이자율을 통제한다.
- **검증**: 이자율 조절에 따라 가계의 저축 성향과 기업의 투자/고용 규모가 유기적으로 변하는지 확인한다.
