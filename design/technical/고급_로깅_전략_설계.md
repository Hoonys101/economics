# 고급 로깅 전략 설계 (Advanced Logging Strategy Design)

## 1. 개요
현재 시뮬레이션의 로그 시스템은 파일 분리 및 기본 샘플링 기능을 통해 개선되었지만, 여전히 로그 볼륨이 크고 필요한 정보를 효율적으로 얻기 어려운 문제가 있습니다. 본 문서는 로그의 가독성을 높이고, 파일 크기를 획기적으로 줄이며, 디버깅 효율성을 극대화하기 위한 고급 로깅 전략을 제안합니다.

## 2. 주요 개선 방안

### 2.1. 로그 레벨 기능 추가
- **문제점:** 모든 로그 메시지가 동일한 중요도로 기록되어, 중요한 정보와 디버그 정보를 구분하기 어렵습니다.
- **해결책:** `utils/logger.py`에 표준 로깅 레벨(DEBUG, INFO, WARNING, ERROR, CRITICAL)을 도입합니다.
    - 각 `log` 호출 시 메시지의 중요도에 따라 적절한 레벨을 지정합니다.
    - `Logger` 클래스에 현재 로깅 레벨을 설정하는 기능을 추가하여, 설정된 레벨 이상의 메시지만 기록되도록 제어합니다.
- **기대효과:**
    - 로그의 가독성 향상 및 정보 필터링 용이성 증대.
    - 운영 환경에서는 INFO 이상, 개발/디버깅 시에는 DEBUG 레벨로 설정하여 유연하게 대응 가능.

### 2.2. 조건부 로깅 (Conditional Logging)
- **문제점:** 모든 에이전트의 모든 상태 변화를 매 틱마다 기록하면 로그가 기하급수적으로 증가합니다.
- **해결책:** 모든 것을 기록하는 대신, '의미 있는 변화'나 '특이 사항'이 발생했을 때만 로그를 남기는 조건부 로깅을 도입합니다.
    - **임계치 기반 로깅 (Threshold-based):** 에이전트의 자산, 재고, 특정 욕구 등이 이전 틱에 비해 일정 비율(예: 10%) 이상 변화했을 때만 상태 로그를 기록합니다.
    - **이벤트 기반 로깅 (Event-driven):** 가계의 파산, 기업의 폐업, 시장에서의 대규모 거래 발생 등 시뮬레이션의 흐름에 큰 영향을 미치는 중요 이벤트가 발생했을 때 관련 상세 로그를 집중적으로 기록합니다.
- **구현 방안:**
    - `Logger.log` 메서드 내에서 `method_name` 또는 `message` 내용을 기반으로 추가적인 조건부 로깅 로직을 구현합니다.
    - 또는, 각 에이전트의 `make_decision` 또는 `update_needs` 메서드 내에서 로깅 전에 조건을 검사하도록 합니다.
- **기대효과:**
    - 로그 파일의 크기를 획기적으로 줄이면서도, 문제 발생 시 필요한 핵심 정보를 놓치지 않습니다.
    - 시뮬레이션의 비정상적인 동작을 감지하고 디버깅하는 데 매우 유용합니다.

### 2.3. 동적 샘플링 로깅 (Dynamic Sampling Logging)
- **문제점:** 현재 샘플링은 고정된 비율로 적용되어, 에이전트 수가 많을 경우에도 여전히 많은 수의 샘플링된 로그가 생성될 수 있습니다.
- **해결책:** 매 틱마다 모든 에이전트의 상세 행동을 기록하는 대신, 무작위로 소수의 에이전트(예: 2~3개)를 선택하여 해당 틱에서는 그 에이전트들의 로그만 상세히 기록하는 동적 에이전트 샘플링을 도입합니다. 이렇게 하면 에이전트 수와 무관하게 로그량을 일정하게 유지하면서도, 전체적인 행동 패턴을 관찰할 수 있습니다.
    - **구현 방안:**
        - `Logger` 클래스에 `set_agent_sampling_pool(agent_ids: List[int])`와 같은 메서드를 추가하여, 특정 틱에 상세 로그를 기록할 에이전트 ID 목록을 설정합니다.
        - `log` 메서드 내에서 `agent_id`가 샘플링 풀에 포함되어 있고, 로그 레벨이 DEBUG 이상일 경우에만 상세 로그를 기록하도록 합니다.
        - `Simulation` 엔진에서 매 틱 시작 시 무작위로 에이전트 몇 개를 선택하여 이 샘플링 풀을 업데이트합니다.
- **기대효과:**
    - 시뮬레이션의 전체적인 통계는 유지하면서, 특정 에이전트의 상세 행동 흐름을 추적할 수 있습니다.
    - 로그 파일의 크기를 더욱 효율적으로 줄일 수 있습니다.

### 2.4. 로그 로테이션 (Log Rotation)

- **문제점:** 로그 파일이 단일 파일에 계속 누적되어 파일 크기가 무한정 커지고, 이로 인해 파일 시스템에 부담을 주거나 분석이 어려워집니다.
- **해결책:** 로그 파일의 크기나 기록된 줄(Line) 수가 설정된 임계치에 도달하면, 현재 로그 파일을 닫고 새로운 번호가 붙은 로그 파일(예: `simulation_log.1.csv`, `simulation_log.2.csv`)을 생성하여 로깅을 이어가는 방식을 도입합니다.
- **기대효과:**
    - 로그 파일이 관리 가능한 크기로 유지되어 분석 및 보관이 용이해집니다.
    - 파일 시스템의 부담을 줄이고, 대용량 로그 파일로 인한 성능 저하를 방지합니다.

## 3. 코드 개선 제안 (개념)

### 3.1. `utils/logger.py` 개선
- `Logger` 클래스에 `level` 속성 및 `set_level(level)` 메서드 추가.
- `log` 메서드에 `level` 인자 추가 및 `self.level`과의 비교 로직 구현.
- `_sampling_rates` 외에 `_agent_sampling_pool`과 같은 속성 추가.

### 3.2. 의사결정 엔진 및 에이전트 코드 개선
- `make_decisions`와 같은 핵심 메서드 내에서 조건부 로깅 로직 구현.
- `Simulation` 엔진에서 매 틱마다 `Logger.set_agent_sampling_pool`을 호출하여 샘플링 대상 에이전트 업데이트.

## 4. 결론
제안된 고급 로깅 전략을 통해 시뮬레이션의 디버깅 효율성을 높이고, 로그 파일 관리의 부담을 줄일 수 있습니다. 이는 프로젝트의 장기적인 유지보수성과 확장성에 크게 기여할 것입니다.