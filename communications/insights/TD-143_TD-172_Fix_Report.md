# TD-143 & TD-172 Fix Report: Documentation Hygiene & Bond Statistics Unification

## 1. Phenomenon & Context
**TD-143 (Documentation Hygiene)**: The repository documentation was cluttered with legacy Work Order (WO-XXX) tags, making it difficult to read and reducing the professional quality of the artifacts.
**TD-172 (Bond Statistics Unification)**: There was a divergence in how "Total Money Issued" was tracked.
- `FinanceSystem.issue_treasury_bonds` (Asynchronous) optimistically updated the `total_money_issued` statistic on the Government agent *before* the transaction was settled.
- `TransactionProcessor` (the source of truth for settlement) did *not* update this statistic when processing `bond_purchase` transactions.
- `bond_repayment` (money destruction) statistics were not tracked at all in the TransactionProcessor.
- This violated the "Settle-then-Record" principle and could lead to data inconsistency.

## 2. Solution Implementation
### Documentation Cleanup
- A script was executed to traverse all Markdown (`.md`) files and strip `WO-XXX` tags (e.g., `WO-053`, `WO-103`) from the text, improving readability.
- **Safety**: The script was designed to:
    - Ignore tags appearing in file paths (e.g., `design/work_orders/WO-057.md`).
    - Ignore tags followed by `.md` extensions (preventing broken links like `[Link](.md)`).
    - Preserve brackets and parentheses to ensure Markdown link syntax (`[WO-079_Config...]` -> `[_Config...]`) and bold syntax (`**WO-103**` -> `****`) remain valid, though possibly empty.

### Bond Statistics Unification
- **Refactored `TransactionProcessor`**:
    - Explicit handling for `bond_purchase` and `bond_repayment` transactions was added to `TransactionProcessor.execute`.
    - **QE Logic**: When the Central Bank is the buyer (in `bond_purchase`), the processor now updates `total_money_issued` *after* successful settlement.
    - **QE Reversal Logic**: When the Central Bank is the seller/recipient (in `bond_repayment`), the processor now updates `total_money_destroyed` *after* successful settlement.
    - **Correction**: Logic correctly identifies the Seller as the Central Bank in repayment scenarios (since Government is the Payer/Buyer in the transaction structure).
- **Refactored `FinanceSystem`**:
    - Removed the optimistic update of `total_money_issued` from `issue_treasury_bonds`. The responsibility for this statistic now resides strictly with the `TransactionProcessor` for asynchronous flows, aligning with the Purity architecture.
    - *Note*: `issue_treasury_bonds_synchronous` retains its manual update logic as it bypasses the transaction queue entirely (Zero-Sum Fix pattern).

## 3. Impact & Verification
- **Data Integrity**: Monetary statistics now strictly reflect *settled* transactions.
- **Observability**: `QUANTITATIVE_EASING` logs are now generated by the `TransactionProcessor`, providing a more accurate audit trail of money creation events.
- **Cleanliness**: Documentation is free of legacy tracking tags, without breaking file references or markdown structures.

## 4. Lessons Learned
- **Orchestration vs. Execution**: Statistics that depend on settlement success must always be updated by the execution engine (`TransactionProcessor`), not the intent generator (`FinanceSystem`). Optimistic updates are a source of drift.
- **Legacy Tags**: Tracking tags in documentation should be transient or stored in metadata, not embedded in the content where they become debt.
- **Regex Safety**: Blind find-and-replace is dangerous; context-aware regex (lookbehind assertions, preserving delimiters) is essential when modifying structural text like paths and markdown links.
