# Insight Report: Purity Gate Enforcement

### 현상 (Phenomenon)
- 에이전트(`Household`, `Firm`) 및 하위 컴포넌트들이 시뮬레이션의 핵심 객체(`Market`, `Bank`)와 전역 `config` 모듈에 직접 의존하기 시작했습니다.
- 이로 인해 모듈 간 결합도가 높아지고, 단위 테스트가 어려워지는 등 아키텍처 부패가 발생했습니다.

### 원인 (Cause)
- "엔진과 에이전트는 DTO를 통해서만 통신해야 한다"는 설계 원칙이 있었지만, 이를 강제할 자동화된 수단이 없었습니다.
- 개발자가 편의를 위해 직접 참조하는 코드를 추가해도 CI/CD 파이프라인에서 감지할 방법이 없었습니다.

### 해결 (Solution)
- Python의 `ast` 모듈을 활용한 정적 분석 스크립트 `scripts/verify_purity.py`를 구현했습니다.
- 이 "Purity Gate"는 에이전트 관련 파일에서 금지된 모듈(`config`) 임포트와 금지된 타입(`Market` 등)의 함수 인자 사용을 감지합니다.
- 이 스크립트를 `scripts/checkpoint.py`에 통합하여 모든 커밋에서 아키텍처 규칙 위반 여부를 자동으로 검증하도록 만들었습니다.

### 교훈 (Lesson Learned)
- **아키텍처 원칙은 반드시 자동화된 도구로 강제해야 합니다.** 설계 문서는 쉽게 무시될 수 있지만, CI/CD 파이프라인을 실패시키는 린터(linter)나 검증 스크립트는 규칙 준수를 보장하는 가장 효과적인 방법입니다.
- 정적 분석은 런타임 이전에 아키텍처 위반을 감지할 수 있는 강력한 도구입니다.
