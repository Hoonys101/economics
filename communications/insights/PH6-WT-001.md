# Watchtower Frontend Implementation [PH6-WT-001]

## Status
**Status:** Scaffolding & Initial Implementation Complete
**Date:** 2024-05-23 (Simulation Time)

## Overview
The "Watchtower" frontend has been scaffolded using Next.js 14 (App Router) and TypeScript. It implements the global sidebar navigation and the four core dashboards: Overview, Finance, Politics, and System. State management is handled by Zustand, with a WebSocket connection manager ready to ingest live simulation data.

## Technical Debt & Mismatches

### 1. Contract Divergence
**Severity:** HIGH
- **Issue:** The TypeScript interface defined in `PH6_WATCHTOWER_CONTRACT.md` differs significantly from the existing Python DTO in `simulation/dtos/watchtower.py`.
- **Detail:**
    - **Frontend Expectation:** `politics.approval_rating` (number), `politics.party` (string enum).
    - **Backend DTO:** `politics` is a Dict containing nested keys like `approval` (dict with total/low/mid/high) and `status` (dict with ruling_party).
    - **Impact:** Direct JSON serialization from the current backend DTO will fail schema validation or cause runtime errors in the frontend.
- **Recommendation:** Update `simulation/dtos/watchtower.py` to match the agreed-upon `PH6-WT-001` contract, or implement an adapter layer in the backend's WebSocket handler to transform the internal state into the contract format.

### 2. Missing WebSocket Implementation
**Severity:** MEDIUM
- **Issue:** The frontend attempts to connect to `ws://localhost:8000/ws/live`, but the backend WebSocket endpoint logic was not part of this mission's scope.
- **Impact:** The frontend will perpetually attempt to reconnect (exponential backoff implemented) and display "Connecting..." or empty states.
- **Recommendation:** Implement the WebSocket server in the simulation backend (likely FastAPI or similar) and ensure it broadcasts the `WatchtowerSnapshot` payload.

### 3. UI/UX Refinements
**Severity:** LOW
- **Issue:** The current implementation uses basic Cards and text to display metrics.
- **Recommendation:** Integrate a charting library (Recharts or Chart.js) to visualize time-series data (e.g., GDP Growth history, Inflation trends) as implied by the "time-series charts" mention in the contract.

## Implementation Details
- **Stack:** Next.js 14, Tailwind CSS, Zustand, Lucide React.
- **Architecture:**
    - `useWatchtowerStore`: Centralized store for the latest snapshot.
    - `ConnectionManager`: Handles WebSocket lifecycle (connect/disconnect/reconnect) independent of UI rendering.
    - **Performance:** React components are designed to re-render only when the store updates. The variable pulse rate (default 1.0s) should be handled comfortably.

## Next Steps
1. Resolve the DTO mismatch in the backend.
2. Implement the WebSocket broadcaster in `simulation`.
3. Verify end-to-end data flow.
