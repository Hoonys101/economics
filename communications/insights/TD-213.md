# TD-213: Multi-Currency Transition Audit

## Overview
This document records the findings of the audit for `DEFAULT_CURRENCY` hardcodings and the state of the transition to a multi-currency system.

## Findings

### 1. Hardcoded `DEFAULT_CURRENCY` Logic
The following areas heavily rely on `DEFAULT_CURRENCY` (USD) and effectively ignore other currencies:

*   **`simulation/metrics/economic_tracker.py`**:
    *   `track` method calculates `total_household_assets`, `total_firm_assets` by summing `assets.get(DEFAULT_CURRENCY, 0.0)`.
    *   `get_m2_money_supply` sums up `DEFAULT_CURRENCY` across agents.
    *   **Impact**: Assets held in other currencies are invisible to global economic metrics.
    *   **Mitigation**: Pending implementation of an Exchange Rate Mechanism to normalize values.

*   **`simulation/firms.py`**:
    *   `Firm` decision making (`make_decision`) and transaction generation (`generate_transactions`) primarily check `DEFAULT_CURRENCY` balance for liquidity and budgeting.
    *   Marketing budget is determined solely by `DEFAULT_CURRENCY` balance.
    *   `liquidate_assets` returns `DEFAULT_CURRENCY` balance.
    *   **Impact**: Firms operating in foreign markets or alternative currencies may fail to budget correctly or appear bankrupt.

*   **`modules/market/housing_planner.py`**:
    *   `calculate_affordability` checks `DEFAULT_CURRENCY` for down payments.

### 2. Transaction Model Limitations
*   `Transaction` dataclass in `simulation/models.py` previously lacked a `currency` field, implicitly assuming all transactions were in `DEFAULT_CURRENCY`.
*   **Resolution**: `currency` field added to `Transaction` (part of this task).

### 3. Handler Specifics
*   `HousingTransactionHandler`: Previously hardcoded to check `DEFAULT_CURRENCY`. Updated to respect `tx.currency`.

## Recommendation for Future Work
To fully support a multi-currency simulation, the following are required:
1.  **Exchange Rate Mechanism**: A system to query exchange rates between currencies.
2.  **Currency Normalization Service**: A service to convert asset bundles into a base currency for reporting (Metrics) and decision making (Agents).
3.  **Multi-Currency Order Books**: Markets need to support asking/bidding in different currencies (or explicit currency pairs).
